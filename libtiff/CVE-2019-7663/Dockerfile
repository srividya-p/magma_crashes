FROM ubuntu:25.04

RUN apt-get update && apt-get install -y git make autoconf automake libtool cmake nasm \
        zlib1g-dev liblzma-dev libjpeg-turbo8-dev wget g++

RUN git clone https://gitlab.com/libtiff/libtiff.git /work
WORKDIR /work
RUN git checkout 651b14ffa91722bd1815e367c8e7708925057430

COPY *.patch /work/
RUN git apply *.patch 

RUN ./autogen.sh && \
    ./configure --disable-shared
RUN make -j$(nproc) clean && \
    make -j$(nproc) && \
    make install

COPY aflplusplus_libtiff_tiffcp_TIF009.rUr /test/crash
WORKDIR /